<!DOCTYPE html>
<html>
<head>
    <title>Where to live</title>
    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/map.js"></script>
    <script src="js/wNumb.js"></script>
    <script src="js/nouislider.min.js"></script>
    <script src="js/foundation.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/map.css">
    <link rel="stylesheet" type="text/css" href="css/nouislider.min.css">
    <link rel="stylesheet" type="text/css" href="css/foundation.min.css">
    <meta name="viewport" content="width=device-width">
</head>

<body>

<div id="content">
    <div id="map"></div>
    
    <button onclick="openSettings();" class="menuButton">=</button>
    
    <div id="settings" style="display: none">
        <div class="row fullWidth">
            <div class="small-3 medium-2 large-1 columns"><span>m<sup>2</sup></span></div>
            <div id="sizeSlider" class="small-9 medium-6 large-4 columns slider"></div>
            <div class="medium-4 large-7 columns"></div>
        </div>
        <div class="row fullWidth">
            <div class="small-3 medium-2 large-1 columns"><span>Kč</span></div>
            <div id="priceSlider" class="small-9 medium-6 large-4 columns slider"></div>
            <div class="medium-4 large-7 columns"></div>
        </div>
        <div class="row fullWidth">
            <div class="small-3 medium-2 large-1 columns"><span>Kč per m<sup>2</sup></span></div>
            <div id="pricePerSquaredMeterSlider" class="small-9 medium-6 large-4 columns slider"></div>
            <div class="medium-4 large-7 columns"></div>
        </div>
    </div>
</div>

<script>
    var map;
    var sizeSlider;
    var priceSlider;
    var pricePerSquaredMeterSlider;
    var dragging = false;
    
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 14
        });
        center();

        initSizeSlider();
        initPriceSlider();
        initPricePerSquaredMeterSlider();
        sizeSlider.noUiSlider.on('update', function(){
            filter();
        });
        priceSlider.noUiSlider.on('update', function(){
            filter();
        });
        pricePerSquaredMeterSlider.noUiSlider.on('update', function(){
            filter();
        });

        map.addListener('bounds_changed', function() {
            if (!dragging) {
                loadHousing();
                updateSizeSlider();
                updatePriceSlider();
                updatePricePerSquaredMeterSlider();
                loadFoodMarkets();
            }
        });

        map.addListener('dragstart', function() {
            dragging = true;
        });

        map.addListener('dragend', function() {
            dragging = false;
            loadHousing();
            updateSizeSlider();
            updatePriceSlider();
            updatePricePerSquaredMeterSlider();
            loadFoodMarkets();
        });

    }
    
    function initSizeSlider() {
        sizeSlider = document.getElementById("sizeSlider");
        noUiSlider.create(sizeSlider, {
            connect: true,
            behaviour: 'tap',
            tooltips: [ wNumb({ decimals: 0 }), wNumb({ decimals: 0 }) ],
            start: [ 50, 100 ],
            range: {
                'min': [ 30 ],
                '10%': [ 50, 5 ],
                '50%': [ 100, 10 ],
                'max': [ 120 ]
            }
        });
    }

    function initPriceSlider() {
        priceSlider = document.getElementById("priceSlider");
        noUiSlider.create(priceSlider, {
            connect: true,
            behaviour: 'tap',
            tooltips: [ wNumb({ decimals: 0 }), wNumb({ decimals: 0 }) ],
            start: [ 10000, 20000 ],
            range: {
                'min': [ 9000 ],
                '10%': [ 10000, 500 ],
                '50%': [ 20000, 1000 ],
                'max': [ 30000 ]
            }
        });
    }

    function initPricePerSquaredMeterSlider() {
        pricePerSquaredMeterSlider = document.getElementById("pricePerSquaredMeterSlider");
        noUiSlider.create(pricePerSquaredMeterSlider, {
            connect: true,
            behaviour: 'tap',
            tooltips: [ wNumb({ decimals: 0 }), wNumb({ decimals: 0 }) ],
            start: [ 0, 200 ],
            range: {
                'min': [ 0 ],
                'max': [ 300 ]
            }
        });
    }
</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1Z6lrl0vLeeihVFwWZekBGb4_7VPUUEY&callback=initMap">
</script>

</body>

</html>